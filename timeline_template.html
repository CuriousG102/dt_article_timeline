<!DOCTYPE html>
<html>
<body>
  <script src='http://d3js.org/d3.v2.min.js'></script>
  <style>
    .timeline .fieldLabel, .fieldDetail, .headline, .summaryLine,
    .timelineMarker {
      font-family: "Times New Roman, Times, serif";
      font-size: 20px;
      font-weight: bold;
    }
    .timeline .headline {
      font-size: 22px;
    }
    .timeline .summaryLine {
      font-size: 18px;
      font-weight: normal;
    }
    .timeline .fieldLabel {
      fill: rgb(204, 102, 0);
    }
    .timeline .fieldDetail, .timelineMarker {
      font-weight: normal;
    }
    .timeline .headline {
      font-size: 22px;
    }
    .timeline .summary {
      font-size: 18px;
      font-weight:normal;
    }
    .timeline .followTick, .followLine {
      fill: #B20000;
    }
    .timeline #fieldLabel {
      fill: rgb(204, 102, 0);
    }
    .headline:hover {
      fill:gray;
    }
  </style>
  <script>
    // Define an object representation for the most important part of
    // any timeline: EVENTS!!!!
    function textWrap(text, charPerLine) {
      var textArray = [];
      var i = 0;
      while (i < text.length) {
        textArray.push(text.substr(i, charPerLine));
        i += charPerLine;
      }
      return textArray;
    }

    var markerFormat = d3.time.format("%B");

    function event() {
      this.firstFieldLabel="";
      this.firstFieldDetail="";
      this.secondFieldLabel="";
      this.secondFieldDetail="";
      this.thirdFieldLabel="";
      this.thirdFieldDetail="";
      this.headline="";
      this.headlineLink="";
      this.summary_="";
      this.date=new Date();
      this.hasFollowDate = false;
      this.followDate=new Date();
      this.imageLink="";
    };

    /*
    //Populate events array
    var events = []
    for (var i = 0; i<4; i++) {
      var newEvent = new event();
      newEvent.firstFieldLabel="Test 1";
      newEvent.firstFieldDetail="Test 1";
      newEvent.secondFieldLabel="Test 2";
      newEvent.secondFieldDetail="Test 2";
      newEvent.thirdFieldLabel="Test 3";
      newEvent.thirdFieldDetail="Test 3";
      newEvent.headline="La LA LAAAAAAA I wrote her off for the tenth time today, and practice all of the things i would say";
      newEvent.hasFollowDate=true;
      newEvent.summary_="Barbarians invaded the forest, leaving devestation and heartbreak in their wake. Life in Zilker park will never be the same for its historic residents.";
      newEvent.imageLink="http://dev.dailytexanonline.com/sites/default/files/images/2015/01/a%20different%20name.jpg"
      events.push(newEvent);
    }
    events[0].date= new Date(2014, 6, 24);
    events[0].followDate= new Date(2014, 8, 28);
    events[1].date= new Date(2014, 8, 14);
    events[1].followDate= new Date(2014, 10, 14)
    events[2].date= new Date(2014, 10, 7);
    events[2].followDate= new Date(2014, 12, 9);
    events[3].date= new Date(2014, 12, 10);
    events[3].followDate= new Date(2015, 1, 17);

    //Find the min and max dates in our events array
    var minDate = d3.min(events, function(d) {return d.date.getTime();})
    if(events[0].hasFollowDate) {
      var maxDate = d3.max(events, function(d) {return d.followDate.getTime();});
    } else {
      var maxDate = d3.max(events, function(d) {return d.date.getTime();});
    }
    */

    //draw ticks (things that mark dates) on the timeline
    var heightOfTimeLine=390;
    var verticalOffsetOfTimeline=5;
    var tickOffset = 107;
    var tickWidth = 23;
    var tickHeight = 5;
    var widthOfTimeline= 7;
    var vertScale = d3.scale.linear()
        .domain([minDate, maxDate])
        .range([verticalOffsetOfTimeline, 
                heightOfTimeLine + verticalOffsetOfTimeline - tickHeight]);

    // draw everything in timeline once the window loads :-)
    window.onload = function() {
      var timeline = d3.select(".timeline");
      var ticks = timeline.selectAll(".tick")
          .data(events)
        .enter().append("rect")
          .attr("x", tickOffset)
          .attr("y", function(d) { return vertScale(d.date.getTime()); })
          .attr("width", tickWidth)
          .attr("height", tickHeight)
          .attr("onmouseover", "loadData(this)");
      loadData(ticks[0][0])

      timeline.select("#beginMarker")
              .text(markerFormat(new Date(minDate)));
      timeline.select("#endMarker")
              .text(markerFormat(new Date(maxDate)));
    }
    
    function date_key(d, i) {
      return d.date.getTime();
    }
    function text_key(d, i) {
      return d.text;
    }

    function loadData(tick) {
      var timeline = d3.selectAll(".timeline");
      if (tick.__data__.hasFollowDate) {
        var followTick = timeline.selectAll(".followTick")
            .data([{date:tick.__data__.followDate}], date_key);
        followTick
          .enter().append("rect")
            .attr("x", tickOffset)
            .attr("y", function(d) { return vertScale(d.date.getTime()); })
            .attr("width", tickWidth)
            .attr("height", tickHeight)
            .attr("class", "followTick");
        followTick.exit().remove();

        var followLine = timeline.selectAll(".followLine")
            .data([{date:tick.__data__.date, followDate:tick.__data__.followDate}], date_key);
        followLine
          .enter().append("rect")
            .attr("x", tickOffset)
            .attr("y", function(d) { 
                          return vertScale(d.date.getTime()) + tickHeight; })
            .attr("width", widthOfTimeline)
            .attr("height", function(d) {
                    return vertScale(d.followDate.getTime()) - vertScale(d.date.getTime()) - tickHeight; })
            .attr("class", "followLine");
        followLine.exit().remove();
      }
      timeline.select("#firstFieldDetail")
              .text(tick.__data__.firstFieldDetail);
      timeline.select("#secondFieldDetail")
              .text(tick.__data__.secondFieldDetail);
      timeline.select("#thirdFieldDetail")
              .text(tick.__data__.thirdFieldDetail);
      timeline.select("#firstFieldLabel")
              .text(tick.__data__.firstFieldLabel);
      timeline.select("#secondFieldLabel")
              .text(tick.__data__.secondFieldLabel);
      timeline.select("#thirdFieldLabel")
              .text(tick.__data__.thirdFieldLabel);
      var headlineText = textWrap(tick.__data__.headline, 51);
      timeline.select("#headlineLine1")
              .text(headlineText[0]);
      timeline.select("#headlineLine2")
              .text(headlineText[1]);
      var summaryText = textWrap(tick.__data__.summary_, 60);
      for (var i = 0; i < 4; i++) {
        timeline.select("#summaryLine" + (i + 1))
              .text(summaryText[i]);
      }
      timeline.select("#image")
              .attr("xlink:href", tick.__data__.imageLink)
    }

  </script>
  <svg width="660" height ="400" class="timeline">
    <text x="90" y="20" class="timelineMarker" id="beginMarker" text-anchor="end">
    </text>
    <text x="90" y="390" class="timelineMarker" id="endMarker" text-anchor="end">
    </text>
    <rect x="100" y="5" width="7" height="390" fill="black" />
    <!--
    <rect x="107" y="36" width="23" height="5" fill="black" />
    <rect x="107" y="164" width="23" height="5" fill="black" />
    <rect x="107" y="348" width="23" height="5" fill="black" />
    <rect x="107" y="363" width="23" height="5" fill="black" />
    <rect x="107" y="378" width="23" height="5" fill="rgb(204, 102, 0)" />
    -->
    <image x="150" y="15" width="300" height="225" id="image"/>
    <text x="470" y="30" class="fieldLabel" id="firstFieldLabel">
    </text>
    <text x="650" y="60" class="fieldDetail" id="firstFieldDetail" text-anchor="end">
    </text>
    <text x="470" y="115" class="fieldLabel" id="secondFieldLabel">
    </text>
    <text x="650" y="145" class="fieldDetail" id="secondFieldDetail" text-anchor="end">
    </text>
    <text x="470" y="200" class="fieldLabel" id="thirdFieldLabel">
    </text>
    <text x="470" y="230" class="fieldDetail" id="thirdFieldDetail">
    </text>
    <text x="150" y="265" class="headline" id="headlineLine1">
    </text>
    <text x="150" y="285" class="headline" id="headlineLine2">
    </text>
    <text x="150" y="310" class="summaryLine" id="summaryLine1">
    </text>
    <text x="150" y="330" class="summaryLine" id="summaryLine2">
    </text>
    <text x="150" y="350" class="summaryLine" id="summaryLine3">
    </text>
    <text x="150" y="370" class="summaryLine" id="summaryLine4">
    </text>
    <text x="600" y="375" font-size="40px" font-family="Times New Roman, Times, serif" font-weight="bold">
      DT
    </text>
    <text x="560" y="398" font-size="20px" font-family="Times New Roman, Times, serif">
      Interactives
    </text>

  </svg>