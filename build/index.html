
<!DOCTYPE html>
<html>
<body>
  <script src='http://d3js.org/d3.v2.min.js'></script>
  <style>
    .timeline .fieldLabel, .fieldDetail, .headline, .summaryLine,
    .timelineMarker {
      font-family: "Times New Roman, Times, serif";
      font-size: 20px;
      font-weight: bold;
    }
    .timeline .headline {
      font-size: 22px;
    }
    .timeline .summaryLine {
      font-size: 18px;
      font-weight: normal;
    }
    .timeline .fieldLabel {
      fill: rgb(204, 102, 0);
    }
    .timeline .fieldDetail, .timelineMarker {
      font-weight: normal;
    }
    .timeline .headline {
      font-size: 22px;
    }
    .timeline .summary {
      font-size: 18px;
      font-weight:normal;
    }
    .timeline .followTick, .followLine {
      fill: rgb(204, 102, 0);
    }
    .timeline #fieldLabel, .tick:hover {
      fill: rgb(204, 102, 0);
    }
    .headlineLink:hover, .photoAttributionLink:hover {
      fill:gray;
    }
  </style>
  <script>
    // Define an object representation for the most important part of
    // any timeline: EVENTS!!!!
    function textWrap(text, charPerLine) {
      var wordsList = text.split(" ");
      var textArray = [];
      var buildString = "";
      var i = 0;
      var nextWord = wordsList.shift();
      while (wordsList.length != 0) {
        if (nextWord.length + i > charPerLine) {
          i = 0;
          textArray.push(buildString);
          buildString = "";
        }
        buildString += nextWord + " ";
        i += nextWord.length + 1;
        nextWord = wordsList.shift();
      }
      if (nextWord.length + i > charPerLine) {
        textArray.push(buildString);
        textArray.push(nextWord);
      }
      else {
        textArray.push(buildString + " " + nextWord);
      }
      return textArray;      
    }

    var markerFormat = d3.time.format("%B");
    var detailFormat = d3.time.format("%B %e");
    var markerYearFormat = d3.time.format("%Y");
    var dateLabelFormat = d3.time.format("%B %e");
    function event() {
      this.firstFieldLabel="";
      this.firstFieldDetail="";
      this.secondFieldLabel="";
      this.secondFieldDetail="";
      this.thirdFieldLabel="";
      this.thirdFieldDetail="";
      this.headline="";
      this.headlineLink="";
      this.summary_="";
      this.date=new Date();
      this.hasFollowDate = false;
      this.followDate=new Date();
      this.imageLink="";
      this.photoAttribution="";
      this.photoAttributionLink="";
    };

    //Populate events array
    var events = []
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Leasing Office Opens:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="";
      newEvent.thirdFieldDetail="";
      newEvent.headline="";
      newEvent.summary_="Pointe on Rio leasing office opens. The building, located on Rio Grande Street, is scheduled to open on Aug. 16, before the start of the fall 2014 semester. The complex was still under construction by the end of the summer.";
      newEvent.imageLink="";
      newEvent.headlineLink="";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
      newEvent.date = new Date(2013, 11 - 1, 13);
      events.push(newEvent);
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Announcement Date:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="New Move-In Date:";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="DT Coverage By:";
      newEvent.thirdFieldDetail="Eleanor Dearman";
      newEvent.headline="Unfinished apartment complex relocates students to Dobie";
      newEvent.summary_="Because of ongoing construction, Pointe on Rio delays its move-in date to Oct. 15, according to an email Asset Campus Housing sent to leaseholders on July 24. The email gave two options for alternative housing: live at the Dobie Center off-campus residence hall rent-free, or receive a rent abatement worth twice the amount of residents' daily rent and stay at outside housing. Pointe on Rio management also gives leaseholders the option of opting out of their lease for free, after Oct. 15.";
      newEvent.imageLink="";
      newEvent.headlineLink="http://www.dailytexanonline.com/2014/08/27/unfinished-apartment-complex-relocates-students-to-dobie";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
        newEvent.hasFollowDate=true;
        newEvent.followDate=new Date(2014,
                                     10 - 1,
                                     15);
      
      newEvent.date = new Date(2014, 7 - 1, 24);
      events.push(newEvent);
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Announcement Date:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="DT Coverage By:";
      newEvent.thirdFieldDetail="Eleanor Dearman";
      newEvent.headline="Pointe on Rio leaseholders say construction delays likely to continue";
      newEvent.summary_="The Daily Texan reports on indications that construction delays are likely to continue, though Pointe on Rio managers decline to comment on the situation. Ten days later, management will officially delay move-in by another three months.";
      newEvent.imageLink="";
      newEvent.headlineLink="http://www.dailytexan.com/";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
      newEvent.date = new Date(2014, 9 - 1, 9);
      events.push(newEvent);
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Announcement Date:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="New Move-In Date:";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="DT Coverage By:";
      newEvent.thirdFieldDetail="Eleanor Dearman";
      newEvent.headline="Pointe on Rio futher delays move-in to January";
      newEvent.summary_="Pointe on Rio management sends an email on Sept. 19 notifying leaseholders that move-in is now delayed to Jan. 10. The email cites 'city inspections and unforeseen construction delays' as the cause for the delay. Pointe on Rio management gives leaseholders the option to continue living at Dobie Center or at their outside housing accommodations, or to cancel their lease before Oct. 21.";
      newEvent.imageLink="";
      newEvent.headlineLink="http://www.dailytexanonline.com/2014/09/26/pointe-on-rio-futher-delays-move-in-to-january";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
        newEvent.hasFollowDate=true;
        newEvent.followDate=new Date(2015,
                                     1 - 1,
                                     10);
      
      newEvent.date = new Date(2014, 9 - 1, 19);
      events.push(newEvent);
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Announcement Date:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="DT Coverage By:";
      newEvent.thirdFieldDetail="Samantha Ketterer";
      newEvent.headline="";
      newEvent.summary_="On Jan. 2, Pointe on Rio management extends its room reservations at Dobie to Jan. 17, according to an email that Pointe on Rio managers sent to leaseholders. In the email, management said although they are taking 'precautionary measures,' they are still optimistic about a Jan. 10 move-in.";
      newEvent.imageLink="";
      newEvent.headlineLink="";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
      newEvent.date = new Date(2015, 1 - 1, 2);
      events.push(newEvent);
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Announcement Date:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="New Move-In Date:";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="DT Coverage By:";
      newEvent.thirdFieldDetail="Samantha Ketterer";
      newEvent.headline="Pointe on Rio apartment building postpones move-in day for third time";
      newEvent.summary_="Pointe on Rio pushes back the move-in date for residents again, to Jan. 17, according to an email sent Jan. 7. The email attributes 'longer than anticipated delays with the City's inspections' as the reason for the change.";
      newEvent.imageLink="";
      newEvent.headlineLink="http://www.dailytexanonline.com/2015/01/09/pointe-on-rio-apartment-building-postpones-move-in-day-for-third-time";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
        newEvent.hasFollowDate=true;
        newEvent.followDate=new Date(2015,
                                     1 - 1,
                                     17);
      
      newEvent.date = new Date(2015, 1 - 1, 7);
      events.push(newEvent);
    
      var newEvent = new event()
      newEvent.firstFieldLabel="Announcement Date:";
      newEvent.firstFieldDetail="";
      newEvent.secondFieldLabel="New Move-In Date:";
      newEvent.secondFieldDetail="";
      newEvent.thirdFieldLabel="DT Coverage By:";
      newEvent.thirdFieldDetail="Samantha Ketterer";
      newEvent.headline="Delayed again: Pointe on Rio managers postpone move-in day for the fourth time";
      newEvent.summary_="In an email sent to leaseholders, managers say the building will open Jan. 24, four days after the start of the spring semester. This is the fourth delay. Managers say they are waiting to receive a certificate of occupancy because of an 'inability to get sidewalks/drives poured,' most likely because of inclement weather. Stays at Dobie continue another week, and the email says Pointe on Rio will pro-rate leaseholders' rents from Jan. 10 until the day of move-in.";
      newEvent.imageLink="";
      newEvent.headlineLink="http://www.dailytexanonline.com/2015/01/14/delayed-again-pointe-on-rio-managers-change-move-in-day-for-the-fourth-time";
      newEvent.photoAttribution="";
      newEvent.photoAttributionLink=""
      
        newEvent.hasFollowDate=true;
        newEvent.followDate=new Date(2015,
                                     1 - 1,
                                     24);
      
      newEvent.date = new Date(2015, 1 - 1, 14);
      events.push(newEvent);
    
    

    //Find the min and max dates in our events array
    var minDate = d3.min(events, function(d) {return d.date.getTime();})
    var maxDate = d3.max(events, function(d) {
                    if (d.hasFollowDate) {
                      return d.followDate.getTime();
                    } else {
                      return d.date.getTime();
                    }
                  });
    

    //draw ticks (things that mark dates) on the timeline
    var heightOfTimeLine=535;
    var verticalOffsetOfTimeline=55;
    var tickOffset = 107;
    var tickWidth = 23;
    var tickHeight = 5;
    var widthOfTimeline= 7;
    var dateLabelPadding = 14;
    var dateLabelXPos = 80;
    var vertScale = d3.scale.linear()
        .domain([minDate, maxDate])
        .range([verticalOffsetOfTimeline, 
                heightOfTimeLine + verticalOffsetOfTimeline - tickHeight]);

    // draw everything in timeline once the window loads :-)
    window.onload = function() {
      var dateLabels = [];
      for (var i = 0; i < events.length; i++) {
        dateLabels.push({ text:dateLabelFormat(events[i].date),
                            x:dateLabelXPos,
                            y:vertScale(events[i].date.getTime()),
                            offset:false
                                            }); 
      }
      console.log(dateLabels);
      for (var i = dateLabels.length - 2; i >= 1; i--) {
        console.log(i);
        if (dateLabels[i].y - dateLabels[i-1].y < dateLabelPadding) {
          dateLabels[i-1].y = dateLabels[i] - 14;
          dateLabels[i-1].offset = true;
        }
      }

      var timeline = d3.select(".timeline");
      var tickGroup = timeline.append("g");
      var ticks = tickGroup.selectAll(".tick")
          .data(events)
        .enter().append("rect")
          .attr("x", tickOffset)
          .attr("y", function(d) { return vertScale(d.date.getTime()); })
          .attr("width", tickWidth)
          .attr("height", tickHeight)
          .attr("onmouseover", "loadData(this)")
          .attr("class", "tick");
      loadData(ticks[0][0])

      timeline.select("#beginMarker")
              .text(markerFormat(new Date(minDate)));
      timeline.select("#beginMarkerYear")
              .text(markerYearFormat(new Date(minDate)));
      timeline.select("#endMarker")
              .text(markerFormat(new Date(maxDate)));
      timeline.select("#endMarkerYear")
              .text(markerYearFormat(new Date(maxDate)));
    }
    
    function date_key(d, i) {
      return d.date.getTime();
    }
    function text_key(d, i) {
      return d.text;
    }

    function loadData(tick) {
      d3.selectAll(".tick").attr("fill", "black")
      var timeline = d3.selectAll(".timeline");
      if (tick.__data__.hasFollowDate) {
        tick.setAttribute("fill", "rgb(204, 102, 0)")
        var followTick = timeline.selectAll(".followTick")
            .data([{date:tick.__data__.followDate}], date_key);
        followTick
          .enter().append("rect")
            .attr("x", tickOffset)
            .attr("y", function(d) { return vertScale(d.date.getTime()); })
            .attr("width", tickWidth)
            .attr("height", tickHeight)
            .attr("class", "followTick");
        followTick.exit().remove();

        var followLine = timeline.selectAll(".followLine")
            .data([{date:tick.__data__.date, followDate:tick.__data__.followDate}], date_key);
        followLine
          .enter().append("rect")
            .attr("x", tickOffset)
            .attr("y", function(d) { 
                          return vertScale(d.date.getTime()) + tickHeight; })
            .attr("width", widthOfTimeline)
            .attr("height", function(d) {
                    return vertScale(d.followDate.getTime()) - vertScale(d.date.getTime()) - tickHeight; })
            .attr("class", "followLine");
        followLine.exit().remove();
      } else {
        timeline.selectAll(".followTick").remove();
        timeline.selectAll(".followLine").remove();
      }
      if (tick.__data__.firstFieldDetail.length > 0) {
        timeline.select("#firstFieldDetail")
                .text(tick.__data__.firstFieldDetail);
      } else {
        timeline.select("#firstFieldDetail")
                .text(detailFormat(tick.__data__.date));
      }
      if (tick.__data__.secondFieldDetail.length > 0 || !tick.__data__.hasFollowDate) {
        timeline.select("#secondFieldDetail")
                .text(tick.__data__.secondFieldDetail);
      } else {
        timeline.select("#secondFieldDetail")
                .text(detailFormat(tick.__data__.followDate));
      }
      timeline.select("#thirdFieldDetail")
              .text(tick.__data__.thirdFieldDetail);
      timeline.select("#firstFieldLabel")
              .text(tick.__data__.firstFieldLabel);
      timeline.select("#secondFieldLabel")
              .text(tick.__data__.secondFieldLabel);
      timeline.select("#thirdFieldLabel")
              .text(tick.__data__.thirdFieldLabel);
      var headlineText = textWrap(tick.__data__.headline, 51);
      timeline.select("#headlineLine1")
              .text(headlineText[0]);
      timeline.select("#headlineLine2")
              .text(headlineText[1]);
      timeline.select(".headlineLink")
              .attr("xlink:href", tick.__data__.headlineLink);
      timeline.select(".photoAttribution")
              .text("Photo By: " + tick.__data__.photoAttribution);
      timeline.select(".photoAttributionLink")
              .attr("xlink:href", tick.__data__.photoAttributionLink);
      var summaryText = textWrap(tick.__data__.summary_, 55);
      for (var i = 0; i < 11; i++) {
        timeline.select("#summaryLine" + (i + 1))
              .text(summaryText[i]);
      }
      timeline.select("#image")
              .attr("xlink:href", tick.__data__.imageLink)
    }

  </script>
  <svg width="660" height ="650" class="timeline">
    <text x="90" y="20" class="timelineMarker" id="beginMarker" text-anchor="end">
    </text>
    <text x="90" y="47" class="timelineMarker" id="beginMarkerYear" text-anchor="end">
    </text>
    <text x="90" y="610" class="timelineMarker" id="endMarker" text-anchor="end">
    </text>
    <text x="90" y="637" class="timelineMarker" id="endMarkerYear" text-anchor="end">
    </text>
    <rect x="100" y="55" width="7" height="535" fill="black" />
    <image x="150" y="15" width="300" height="225" id="image"/>
    <text x="470" y="30" class="fieldLabel" id="firstFieldLabel">
    </text>
    <text x="650" y="60" class="fieldDetail" id="firstFieldDetail" text-anchor="end">
    </text>
    <text x="470" y="95" class="fieldLabel" id="secondFieldLabel">
    </text>
    <text x="650" y="125" class="fieldDetail" id="secondFieldDetail" text-anchor="end">
    </text>
    <text x="470" y="160" class="fieldLabel" id="thirdFieldLabel">
    </text>
    <text x="470" y="190" class="fieldDetail" id="thirdFieldDetail">
    </text>
    <a class="photoAttributionLink">
      <text x="470" y="235" class="photoAttribution">
      </text>
    </a>
    <a class="headlineLink">
      <text x="150" y="265" class="headline" id="headlineLine1">
      </text>
      <text x="150" y="285" class="headline" id="headlineLine2">
      </text>
    </a>
    <text x="150" y="310" class="summaryLine" id="summaryLine1">
    </text>
    <text x="150" y="330" class="summaryLine" id="summaryLine2">
    </text>
    <text x="150" y="350" class="summaryLine" id="summaryLine3">
    </text>
    <text x="150" y="370" class="summaryLine" id="summaryLine4">
    </text>
    <text x="150" y="390" class="summaryLine" id="summaryLine5">
    </text>
    <text x="150" y="410" class="summaryLine" id="summaryLine6">
    </text>
    <text x="150" y="430" class="summaryLine" id="summaryLine7">
    </text>
    <text x="150" y="450" class="summaryLine" id="summaryLine8">
    </text>
    <text x="150" y="470" class="summaryLine" id="summaryLine9">
    </text>
    <text x="150" y="490" class="summaryLine" id="summaryLine10">
    </text>
    <text x="150" y="510" class="summaryLine" id="summaryLine11">
    </text>
    <text x="600" y="625" font-size="40px" font-family="Times New Roman, Times, serif" font-weight="bold">
      DT
    </text>
    <text x="560" y="648" font-size="20px" font-family="Times New Roman, Times, serif">
      Interactives
    </text>

  </svg>
</body>
</html>
